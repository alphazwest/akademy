"""
Helper functions for unit testing.
"""
import copy

import numpy as np
import pandas as pd

# define some explicit sample data. Sample taken from Yahoo Finance's SPY
SAMPLE_CSV_DATA = [
    ["Date", "Open", "High", "Low", "Close", "Adj Close", "Volume"],
    ["1993-01-29", "43.968750", "43.968750", "43.750000", "43.937500", "25.218224", "1003200"],
    ["1993-02-01", "43.968750", "44.250000", "43.968750", "44.250000", "25.397587", "480500"],
    ["1993-02-02", "44.218750", "44.375000", "44.125000", "44.343750", "25.451399", "201300"],
    ["1993-02-03", "44.406250", "44.843750", "44.375000", "44.812500", "25.720442", "529400"],
    ["1993-02-04", "44.968750", "45.093750", "44.468750", "45.000000", "25.828051", "531500"],
    ["1993-02-05", "44.968750", "45.062500", "44.718750", "44.968750", "25.810120", "492100"],
    ["1993-02-08", "44.968750", "45.125000", "44.906250", "44.968750", "25.810120", "596100"],
    ["1993-02-09", "44.812500", "44.812500", "44.562500", "44.656250", "25.630747", "122100"],
    ["1993-02-10", "44.656250", "44.750000", "44.531250", "44.718750", "25.666632", "379600"],
    ["1993-02-11", "44.781250", "45.125000", "44.781250", "44.937500", "25.792181", "19500"],
    ["1993-02-12", "44.875000", "44.875000", "44.593750", "44.593750", "25.594887", "42500"],
    ["1993-02-16", "44.468750", "44.468750", "43.406250", "43.468750", "24.949190", "374800"],
    ["1993-02-17", "43.468750", "43.531250", "43.281250", "43.437500", "24.931263", "210900"],
    ["1993-02-18", "43.937500", "43.937500", "42.812500", "43.406250", "24.913305", "378100"],
    ["1993-02-19", "43.406250", "43.562500", "43.343750", "43.562500", "25.003000", "34900"],
    ["1993-02-22", "43.687500", "43.781250", "43.562500", "43.718750", "25.092669", "513600"],
    ["1993-02-23", "43.843750", "43.875000", "43.468750", "43.687500", "25.074743", "373700"],
    ["1993-02-24", "43.718750", "44.250000", "43.718750", "44.250000", "25.397587", "26300"],
    ["1993-02-25", "44.218750", "44.375000", "44.125000", "44.343750", "25.451399", "44500"],
    ["1993-02-26", "44.437500", "44.437500", "44.187500", "44.406250", "25.487251", "66200"],
    ["1993-03-01", "44.562500", "44.562500", "44.218750", "44.281250", "25.415516", "66500"],
    ["1993-03-02", "44.312500", "44.937500", "44.250000", "44.937500", "25.792181", "182400"],
    ["1993-03-03", "45.000000", "45.156250", "44.937500", "45.125000", "25.899797", "280100"],
    ["1993-03-04", "45.187500", "45.187500", "44.875000", "44.875000", "25.756304", "89500"],
    ["1993-03-05", "44.937500", "45.125000", "44.718750", "44.750000", "25.684553", "40000"],
    ["1993-03-08", "44.843750", "45.750000", "44.843750", "45.750000", "26.258512", "50800"],
    ["1993-03-09", "45.656250", "45.687500", "45.500000", "45.593750", "26.168848", "169300"],
    ["1993-03-10", "45.593750", "45.687500", "45.406250", "45.687500", "26.222641", "194400"],
    ["1993-03-11", "45.718750", "45.843750", "45.500000", "45.562500", "26.150902", "70900"],
    ["1993-03-12", "45.187500", "45.218750", "44.812500", "45.093750", "25.881868", "643600"],
    ["1993-03-15", "45.062500", "45.312500", "45.062500", "45.312500", "26.007410", "310800"],
    ["1993-03-16", "45.312500", "45.437500", "45.312500", "45.312500", "26.007410", "30800"],
    ["1993-03-17", "45.250000", "45.250000", "44.968750", "45.031250", "25.845987", "21800"],
    ["1993-03-18", "45.218750", "45.500000", "45.218750", "45.312500", "26.007410", "59300"],
    ["1993-03-19", "45.281250", "45.281250", "45.031250", "45.031250", "25.968052", "66900"],
    ["1993-03-22", "44.593750", "44.875000", "44.562500", "44.781250", "25.823881", "183400"],
    ["1993-03-23", "44.906250", "44.937500", "44.812500", "44.875000", "25.877949", "55200"],
    ["1993-03-24", "44.812500", "45.062500", "44.593750", "44.875000", "25.877949", "37200"],
    ["1993-03-25", "44.906250", "45.250000", "44.843750", "45.156250", "26.040136", "110100"],
    ["1993-03-26", "45.125000", "45.156250", "44.875000", "44.906250", "25.895981", "101500"],
    ["1993-03-29", "44.937500", "45.312500", "44.937500", "45.093750", "26.004105", "87100"],
    ["1993-03-30", "45.156250", "45.218750", "45.093750", "45.218750", "26.076170", "56000"],
    ["1993-03-31", "45.343750", "45.468750", "45.187500", "45.187500", "26.058161", "111600"],
    ["1993-04-01", "45.250000", "45.250000", "44.937500", "45.031250", "25.968052", "129500"],
    ["1993-04-02", "44.656250", "44.656250", "44.093750", "44.093750", "25.427444", "59400"],
    ["1993-04-05", "44.437500", "44.437500", "44.187500", "44.312500", "25.553576", "172200"],
    ["1993-04-06", "44.406250", "44.406250", "44.062500", "44.187500", "25.481506", "129700"],
    ["1993-04-07", "44.250000", "44.343750", "44.156250", "44.343750", "25.571604", "28000"],
    ["1993-04-08", "44.531250", "44.531250", "44.093750", "44.281250", "25.535551", "180800"],
    ["1993-04-12", "44.718750", "44.937500", "44.656250", "44.906250", "25.895981", "348500"]
]


def get_sample_test_data():
    """
    Returns a PandasDataframe object of OHLCV data from the SPY etf dating
    1993-01-29 - 1993-04-12 with the following header:
        "Date", "Open", "High", "Low", "Close", "Adj Close", "Volume",
    """
    source = copy.deepcopy(SAMPLE_CSV_DATA)
    header = source.pop(0)
    data = pd.DataFrame(data=source, columns=header)

    # lowercase all column names for standardization
    data.columns = [x.lower() for x in data.columns]

    # drop all but essential pricing + date + volume
    data = data[['date', 'open', 'high', 'low', 'close', 'volume']]

    # convert types
    data = data.astype(
        {
            'open': np.float32,
            'high': np.float32,
            'low': np.float32,
            'close': np.float32,
            'volume': np.float32
        }
    )

    # reindex
    data.set_index('date', inplace=True)

    return data
